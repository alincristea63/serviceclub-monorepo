events {
    worker_connections 1024;
}

http {
    upstream hub-app {
        server hub-app:3000;
    }

    upstream academy {
        server academy:3001;
    }

    upstream jobs {
        server jobs:3002;
    }

    upstream shop {
        server shop:3003;
    }

    upstream services {
        server services:3004;
    }

    upstream communities {
        server communities:3005;
    }

    # Main domain - Hub App
    server {
        listen 80;
        server_name serviceclub.com www.serviceclub.com;

        location / {
            proxy_pass http://hub-app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Academy subdomain
    server {
        listen 80;
        server_name academy.serviceclub.com;

        location / {
            proxy_pass http://academy;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Jobs subdomain
    server {
        listen 80;
        server_name jobs.serviceclub.com;

        location / {
            proxy_pass http://jobs;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Shop subdomain
    server {
        listen 80;
        server_name shop.serviceclub.com;

        location / {
            proxy_pass http://shop;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Services subdomain
    server {
        listen 80;
        server_name services.serviceclub.com;

        location / {
            proxy_pass http://services;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Communities subdomain
    server {
        listen 80;
        server_name communities.serviceclub.com;

        location / {
            proxy_pass http://communities;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }

    # Development - localhost routing
    server {
        listen 80;
        server_name localhost;

        # Hub app (default)
        location / {
            proxy_pass http://hub-app;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # Academy path
        location /academy {
            rewrite ^/academy(.*) $1 break;
            proxy_pass http://academy;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
} 